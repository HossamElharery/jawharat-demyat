<div class="add-role-container p-4">
  <!-- Header -->
  <div class="d-flex align-items-center">
    <i class="pi pi-users text-warning me-2"></i>
    <h3 class="mb-0">{{ isEditMode ? ('Edit Role' | translate) : ('Add New Role' | translate) }}</h3>
  </div>

  <p class="text-muted my-3">{{ 'Define role permissions to control access to different parts of the system.' | translate }}</p>

  <!-- Role Name Input -->
  <form [formGroup]="roleForm">
    <div class="mb-4">
      <label for="roleName" class="form-label">{{ 'Role Name' | translate }}</label>
      <input
        type="text"
        id="roleName"
        class="form-control"
        formControlName="name"
        [class.is-invalid]="roleForm.get('name')?.invalid && roleForm.get('name')?.touched"
      >
      <div class="invalid-feedback" *ngIf="roleForm.get('name')?.hasError('required')">
        {{ 'Role name is required' | translate }}
      </div>
      <div class="invalid-feedback" *ngIf="roleForm.get('name')?.hasError('minlength')">
        {{ 'Role name must be at least 3 characters' | translate }}
      </div>
    </div>
  </form>

  <!-- Loading Indicator -->
  <div class="text-center my-5" *ngIf="loading">
    <i class="pi pi-spin pi-spinner text-warning" style="font-size: 2rem;"></i>
    <p class="mt-2">{{ 'Loading permissions...' | translate }}</p>
  </div>

  <!-- Module Permissions -->
  <div class="modules-container" *ngIf="!loading">
    <!-- Dashboard Module -->
    <div class="module-section mb-4" *ngFor="let module of modules">
      <div class="module-header d-flex justify-content-between align-items-center p-3">
        <div class="d-flex align-items-center">
          <i class="pi {{module.icon}} text-warning me-2"></i>
          <h4 class="mb-0">{{ module.name | translate }}</h4>
        </div>
        <p-inputSwitch [(ngModel)]="module.enabled"></p-inputSwitch>
      </div>

      <div class="permissions-table" *ngIf="module.enabled">
        <div class="permissions-header d-flex">
          <div class="permission-name flex-grow-1">{{ 'Permission Name' | translate }}</div>
          <div class="permission-action" *ngIf="module.permissions[0].viewId">{{ 'View' | translate }}</div>
          <div class="permission-action" *ngIf="module.permissions[0].addId">{{ 'Add' | translate }}</div>
          <div class="permission-action" *ngIf="module.permissions[0].editId">{{ 'Edit' | translate }}</div>
          <div class="permission-action" *ngIf="module.permissions[0].deleteId">{{ 'Delete' | translate }}</div>
        </div>

        <div class="permission-row d-flex" *ngFor="let permission of module.permissions">
          <div class="permission-name flex-grow-1">{{ permission.name | translate }}</div>
          <div class="permission-action" *ngIf="permission.viewId">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" [(ngModel)]="permission.view">
            </div>
          </div>
          <div class="permission-action" *ngIf="permission.addId">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" [(ngModel)]="permission.add">
            </div>
          </div>
          <div class="permission-action" *ngIf="permission.editId">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" [(ngModel)]="permission.edit">
            </div>
          </div>
          <div class="permission-action" *ngIf="permission.deleteId">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" [(ngModel)]="permission.delete">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Buttons -->
  <div class="d-flex justify-content-end mt-4 action-buttons">
    <button
      type="button"
      class="btn btn-outline-secondary me-2 cancel-btn"
      (click)="cancel()"
      [disabled]="saving">
      {{ 'Cancel' | translate }}
    </button>
    <button
      type="button"
      class="btn btn-warning save-btn"
      (click)="saveRole()"
      [disabled]="saving">
      <i class="pi pi-spin pi-spinner me-2" *ngIf="saving"></i>
      {{ (saving ? 'Saving...' : 'Save') | translate }}
    </button>
  </div>
</div>
