<div class="tasks-main">

<div class="white-card">
  <div class="project-name-section">
    <div class="left-section">
      <h2>Project Name</h2>
      <div class="icon-buttons">
        <button class="icon-btn">
          <i class="pi pi-link"></i>
        </button>
        <button class="icon-btn">
          <i class="pi pi-smile"></i>
        </button>
      </div>
    </div>
    <div class="right-section">
      <button pButton type="button"
              label="Invite"
              icon="pi pi-plus"
              class="invite-btn"></button>
      <div class="members-group">
        <img *ngFor="let member of members" [src]="member.image" [alt]="member.name">
        <div class="more-count">+2</div>
      </div>
    </div>
  </div>
</div>

<div class="actions-section">
  <div class="left-buttons">
    <p-dropdown [options]="filterOptions"
                [(ngModel)]="selectedFilter"
                [showClear]="false"
                placeholder="Filter"
                styleClass="custom-dropdown"
                (onChange)="onFilterChange($event)">
      <ng-template pTemplate="selectedItem">
        <div class="selected-item">
          <app-icon class="mx-1" name="filter" color="#64748B"></app-icon>
          <span>{{getFilterLabel()}}</span>
        </div>
      </ng-template>
      <ng-template pTemplate="item" let-option>
        <div class="dropdown-item">
          <span>{{option.label}}</span>
        </div>
      </ng-template>
    </p-dropdown>

    <p-dropdown [options]="memberOptions"
                [(ngModel)]="selectedMember"
                [showClear]="false"
                placeholder="All Members"
                styleClass="custom-dropdown"
                (onChange)="onMemberChange($event)">
      <ng-template pTemplate="selectedItem">
        <div class="selected-item">
          <app-icon class="mx-1" name="calender" color="#64748B"></app-icon>
          <span>{{getMemberLabel()}}</span>
        </div>
      </ng-template>
      <ng-template pTemplate="item" let-option>
        <div class="dropdown-item">
          <span>{{option.label}}</span>
        </div>
      </ng-template>
    </p-dropdown>
  </div>
  <div class="right-buttons">
    <button pButton type="button" class="secondary-btn">
      <app-icon class="mx-1" name="group" color="#64748B"></app-icon>

      Share
    </button>
    <div class="view-buttons">
      <button pButton type="button"
              class="view-btn"
              [class.active]="viewMode === 'table'"
              (click)="viewMode = 'table'">

        <app-icon class="mx-1" name="list" color="#64748B"></app-icon>



      </button>
      <button pButton type="button"
              class="view-btn"
              [class.active]="viewMode === 'kanban'"
              (click)="viewMode = 'kanban'">
              <svg width="21" height="22" viewBox="0 0 21 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15.1949 8.5C16.5756 8.5 17.6949 7.38071 17.6949 6C17.6949 4.61929 16.5756 3.5 15.1949 3.5C13.8142 3.5 12.6949 4.61929 12.6949 6C12.6949 7.38071 13.8142 8.5 15.1949 8.5Z" fill="white" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5.50001 8.5C6.88072 8.5 8 7.38071 8 6C8 4.61929 6.88072 3.5 5.50001 3.5C4.11929 3.5 3 4.61929 3 6C3 7.38071 4.11929 8.5 5.50001 8.5Z" fill="white" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M15.1949 18.5C16.5756 18.5 17.6949 17.3807 17.6949 16C17.6949 14.6193 16.5756 13.5 15.1949 13.5C13.8142 13.5 12.6949 14.6193 12.6949 16C12.6949 17.3807 13.8142 18.5 15.1949 18.5Z" fill="white" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M5.50001 18.5C6.88072 18.5 8 17.3807 8 16C8 14.6193 6.88072 13.5 5.50001 13.5C4.11929 13.5 3 14.6193 3 16C3 17.3807 4.11929 18.5 5.50001 18.5Z" fill="white" stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>

              </button>
    </div>
    <button  (click)="openAddTaskSidebar()" pButton type="button"
            label="Add New Task"
            class="add-task-btn"></button>
  </div>
</div>
  <!-- Kanban View -->
  <div class="kanban-view" *ngIf="viewMode === 'kanban'">
    <div class="kanban-column" *ngFor="let status of ['To Do', 'In Progress', 'Done']"
         [ngClass]="status.toLowerCase().replace(' ', '-')">

      <div class="column-header">
        <div class="status-group">
          <span class="status-dot" [class]="status.toLowerCase().replace(' ', '-')"></span>
          <span class="status-title">{{status}}</span>
          <span class="task-count">{{getTaskCount(status)}}</span>
        </div>
        <button pButton class="p-button-text" icon="pi pi-plus"></button>
      </div>

      <!-- Full-width line under the title -->
      <div class="status-line"></div>

      <div class="task-list" pDroppable (onDrop)="onDrop($event, status)">
        <div class="task-card" *ngFor="let task of getTasks(status)"
             pDraggable
             (onDragStart)="onDragStart($event, task)"
             (onDragEnd)="onDragEnd()">
          <div class="card-header">
            <span class="priority-tag">{{task.priority}}</span>
            <div class="menu-trigger">
              <i class="pi pi-ellipsis-h"></i>
            </div>
          </div>
          <h3 class="task-title">{{task.title}}</h3>
          <p class="task-description">{{task.description}}</p>
          <div class="card-footer">
            <div class="assigned-members">
              <img *ngFor="let member of task.assignedTo" [src]="member.image" [alt]="member.name">
            </div>
            <div class="task-metrics">
              <span class="metric">
                <i class="pi pi-comments"></i>
                {{task.comments}}
              </span>
              <span class="metric">
                <i class="pi pi-paperclip"></i>
                {{task.files}}
              </span>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>


  <!-- Table View -->
  <div class="table-view" *ngIf="viewMode === 'table'">
    <p-table [value]="allTasks" styleClass="task-table">
      <ng-template pTemplate="header">
        <tr>
          <th>Task Title</th>
          <th>State</th>
          <th>Priority</th>
          <th>Assigned To</th>
          <th>Files</th>
          <th>Deadline</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-task>
        <tr>
          <td>{{task.title}}</td>
          <td>
            <div class="state-indicator">
              <span class="status-dot" [class]="task.state.toLowerCase().replace(' ', '-')"></span>
              {{task.state}}
            </div>
          </td>
          <td>
            <span class="priority-tag">{{task.priority}}</span>
          </td>
          <td>
            <div class="assigned-members small">
              <img *ngFor="let member of task.assignedTo" [src]="member.image" [alt]="member.name">
              <span class="more-members">+2</span>
            </div>
          </td>
          <td>{{task.files}}</td>
          <td>{{task.deadline}}</td>
          <td>
            <div class="action-buttons">
              <!-- <i class="pi pi-eye"></i> -->
              <app-icon class="mx-1" name="eye" color="#64748B"></app-icon>
              <app-icon class="mx-1" name="edit" color="#64748B"></app-icon>
              <app-icon class="mx-1" name="delete" color="#64748B"></app-icon>

              <!-- <i class="pi pi-pencil"></i>
              <i class="pi pi-trash"></i> -->
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
<!-- <app-add-task-sidebar #addTaskSidebar (close)="onSidebarClose()"></app-add-task-sidebar> -->
<app-add-task-sidebar #addTaskSidebar (close)="onSidebarClose()" (saved)="onTaskSaved($event)"></app-add-task-sidebar>
