<div class="expenses-container">
  <!-- Loading indicator -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner-border text-warning" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading expense data...</p>
  </div>

  <div *ngIf="!isLoading">
    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card" *ngFor="let summary of summaries">
        <div class="card-icon" [ngStyle]="{'background-color': summary.iconColor + '15'}">
          <app-icon [name]="summary.icon" [color]="summary.iconColor"></app-icon>
        </div>
        <div class="card-content">
          <div class="card-count">{{summary.count}}</div>
          <div class="card-label">{{summary.label}}</div>
        </div>
      </div>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
      <div class="search-container">
        <i class="pi pi-search search-icon"></i>
        <input type="text" pInputText placeholder="Search For anything" class="search-input" (input)="searchExpenses($event)">
      </div>

      <div class="filter-actions">
        <p-dropdown
          [options]="statusOptions"
          [(ngModel)]="selectedStatus"
          optionLabel="label"
          optionValue="value"
          (onChange)="onStatusChange()"
          styleClass="status-dropdown">
          <ng-template pTemplate="selectedItem">
            <div class="status-option">
              <span>{{selectedStatus === 'all' ? 'All' : (selectedStatus | titlecase)}}</span>
              <i class="pi pi-chevron-down"></i>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="status-option">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-dropdown>

        <button pButton type="button" label="Add Expense" icon="pi pi-plus" class="add-expense-btn"
          (click)="addExpense()" *ngIf="canCreateExpenses"></button>
      </div>
    </div>

    <!-- Expenses Table -->
    <div class="expenses-table" *ngIf="filteredExpenses.length > 0">
      <div class="table-header">
        <div class="header-cell employee">Employee</div>
        <div class="header-cell title">Title</div>
        <div class="header-cell due-date">Date</div>
        <div class="header-cell value">Value</div>
        <div class="header-cell status">Status</div>
        <div class="header-cell actions">Actions</div>
      </div>

      <div class="table-body">
        <div class="table-row" *ngFor="let expense of filteredExpenses">
          <div class="body-cell employee">
            <div class="employee-info">
              <img [src]="getEmployeeAvatar(expense)" alt="Employee Avatar" class="employee-avatar">
              <span class="employee-name">{{getEmployeeName(expense)}}</span>
            </div>
          </div>
          <div class="body-cell title">{{expense.title}}</div>
          <div class="body-cell due-date">{{formatDate(expense.date)}}</div>
          <div class="body-cell value">{{formatValue(expense.value)}}</div>
          <div class="body-cell status">
            <span class="status-badge" [ngClass]="getStatusClass(expense.status)">
              {{expense.status | titlecase}}
            </span>
          </div>
          <div class="body-cell actions">
            <button pButton pRipple class="p-button-text view-btn" (click)="viewExpense(expense)"
              pTooltip="View Details" tooltipPosition="top">
              <i class="pi pi-eye"></i>
            </button>

            <ng-container *ngIf="expense.status === 'pending' && canUpdateExpenses">
              <button pButton pRipple class="p-button-text accept-btn" (click)="updateExpenseStatus(expense, 'accepted')"
                pTooltip="Approve" tooltipPosition="top">
                <i class="pi pi-check"></i>
              </button>

              <button pButton pRipple class="p-button-text reject-btn" (click)="updateExpenseStatus(expense, 'rejected')"
                pTooltip="Reject" tooltipPosition="top">
                <i class="pi pi-times"></i>
              </button>
            </ng-container>

            <button pButton pRipple class="p-button-text delete-btn" *ngIf="canDeleteExpenses"
              (click)="deleteExpense(expense)" pTooltip="Delete" tooltipPosition="top">
              <i class="pi pi-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty state if no expenses -->
    <div class="empty-state" *ngIf="filteredExpenses.length === 0">
      <div class="empty-icon">
        <i class="pi pi-file"></i>
      </div>
      <h3>No Expenses Found</h3>
      <p>Create a new expense request or try a different filter</p>
      <button pButton type="button" label="Add Your First Expense" icon="pi pi-plus" class="add-expense-btn"
        (click)="addExpense()" *ngIf="canCreateExpenses"></button>
    </div>

    <!-- Pagination -->
    <app-pagination
      *ngIf="totalExpenses > 0"
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      [totalItemsCount]="totalExpenses"
      [perPage]="perPage"
      [theme]="'warning'"
      (pageChange)="onPageChange($event)"
      (perPageChange)="onPerPageChange($event)">
    </app-pagination>
  </div>

  <!-- Confirmation Dialog for actions -->
  <p-confirmDialog></p-confirmDialog>
</div>
